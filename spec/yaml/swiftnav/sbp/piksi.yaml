# Copyright (C) 2015 Swift Navigation Inc.
# Contact: Fergus Noble <fergus@swiftnav.com>
#
# This source is subject to the license found in the file 'LICENSE' which must
# be be distributed together with this source. All other rights reserved.
#
# THIS CODE AND INFORMATION IS PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND,
# EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED
# WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE.

package: swiftnav.sbp.piksi
description: |
  System health, configuration, and diagnostic messages specific to
  the Piksi L1 receiver, including a variety of legacy messages that
  may no longer be used.

stable: False
public: True
include:
  - types.yaml
  - gnss_signal.yaml
definitions:

 - MSG_ALMANAC:
    id: 0x0069
    short_desc: Legacy message to load satellite almanac (host => Piksi)
    desc: |
      This is a legacy message for sending and loading a satellite
      alamanac onto the Piksi's flash memory from the host.

 - MSG_SET_TIME:
    id: 0x0068
    short_desc: Send GPS time from host (host => Piksi)
    desc: |
      This message sets up timing functionality using a coarse GPS
      time estimate sent by the host.

 - MSG_RESET:
    id: 0x00B2
    short_desc: Reset the device (host => Piksi)
    desc: |
      This message from the host resets the Piksi back into the
      bootloader.

 - MSG_CW_RESULTS:
    id: 0x00C0
    short_desc: Legacy message for CW interference channel (Piksi => host)
    desc: |
      This is an unused legacy message for result reporting from the
      CW interference channel on the SwiftNAP. This message will be
      removed in a future release.

 - MSG_CW_START:
    id: 0x00C1
    short_desc: Legacy message for CW interference channel (host => Piksi)
    desc: |
      This is an unused legacy message from the host for starting
      the CW interference channel on the SwiftNAP. This message will
      be removed in a future release.

 - MSG_RESET_FILTERS:
    id: 0x0022
    short_desc: Reset IAR filters (host => Piksi)
    desc: |
      This message resets either the DGNSS Kalman filters or Integer
      Ambiguity Resolution (IAR) process.
    fields:
      - filter:
          type: u8
          desc: Filter flags
          fields:
            - 1-7:
                desc: Reserved
            - 0:
                desc: Filter or process to reset
                values:
                  - 0: DGNSS filter
                  - 1: IAR process

 - MSG_INIT_BASE:
    id: 0x0023
    short_desc: Initialize IAR from known baseline (host => device)
    desc: |
      This message initializes the integer ambiguity resolution (IAR)
      process on the Piksi to use an assumed baseline position between
      the base station and rover receivers. Warns via MSG_PRINT if
      there aren't a shared minimum number (4) of satellite
      observations between the two.

 - MSG_THREAD_STATE:
    id: 0x0017
    short_desc: State of an RTOS thread
    desc: |
      The thread usage message from the device reports real-time
      operating system (RTOS) thread usage statistics for the named
      thread. The reported percentage values must be normalized.
    fields:
        - name:
            type: string
            size: 20
            desc: Thread name (NULL terminated)
        - cpu:
            type: u16
            desc: |
              Percentage cpu use for this thread. Values range from 0
              - 1000 and needs to be renormalized to 100
        - stack_free:
            type: u32
            units: bytes
            desc: Free stack space for this thread

 - UARTChannel:
    short_desc: State of the UART channel
    desc: |
      Throughput, utilization, and error counts on the RX/TX buffers
      of this UART channel. The reported percentage values must
      be normalized.
    fields:
        - tx_throughput:
            type: float
            units: kB/s
            desc: UART transmit throughput
        - rx_throughput:
            type: float
            units: kB/s
            desc: UART receive throughput
        - crc_error_count:
            type: u16
            desc: UART CRC error count
        - io_error_count:
            type: u16
            desc: UART IO error count
        - tx_buffer_level:
            type: u8
            desc: |
              UART transmit buffer percentage utilization (ranges from
              0 to 255)
        - rx_buffer_level:
            type: u8
            desc: |
              UART receive buffer percentage utilization (ranges from
              0 to 255)

 - Latency:
    short_desc: Receiver-to-base station latency
    desc: |
      Statistics on the latency of observations received from the base
      station. As observation packets are received their GPS time is
      compared to the current GPS time calculated locally by the
      receiver to give a precise measurement of the end-to-end
      communication latency in the system.
    fields:
        - avg:
            type: s32
            units: ms
            desc: Average latency
        - lmin:
            type: s32
            units: ms
            desc: Minimum latency
        - lmax:
            type: s32
            units: ms
            desc: Maximum latency
        - current:
            type: s32
            units: ms
            desc: Smoothed estimate of the current latency

 - MSG_UART_STATE:
    id: 0x001D
    short_desc: State of the UART channels
    desc: |
      The UART message reports data latency and throughput of the UART
      channels providing SBP I/O. On the default Piksi configuration,
      UARTs A and B are used for telemetry radios, but can also be
      host access ports for embedded hosts, or other interfaces in
      future. The reported percentage values must be normalized.
    fields:
        - uart_a:
            type: UARTChannel
            desc: State of UART A
        - uart_b:
            type: UARTChannel
            desc: State of UART B
        - uart_ftdi:
            type: UARTChannel
            desc: State of UART FTDI (USB logger)
        - latency:
            type: Latency
            desc: UART communication latency
        - obs_period:
            type: Latency
            desc: Observation receipt period


 - MSG_UART_STATE_DEPA:
    id: 0x0018
    short_desc: State of the UART channels
    desc: |
      The UART message reports data latency and throughput of the UART
      channels providing SBP I/O. On the default Piksi configuration,
      UARTs A and B are used for telemetry radios, but can also be
      host access ports for embedded hosts, or other interfaces in
      future. The reported percentage values must be normalized.
    fields:
        - uart_a:
            type: UARTChannel
            desc: State of UART A
        - uart_b:
            type: UARTChannel
            desc: State of UART B
        - uart_ftdi:
            type: UARTChannel
            desc: State of UART FTDI (USB logger)
        - latency:
            type: Latency
            desc: UART communication latency

 - MSG_IAR_STATE:
    id: 0x0019
    short_desc: State of the Integer Ambiguity Resolution (IAR) process
    desc: |
      This message reports the state of the Integer Ambiguity
      Resolution (IAR) process, which resolves unknown integer
      ambiguities from double-differenced carrier-phase measurements
      from satellite observations.
    fields:
        - num_hyps:
            type: u32
            desc: Number of integer ambiguity hypotheses remaining

 - MSG_MASK_SATELLITE:
    id: 0x001B
    short_desc: Mask a satellite from use in Piksi subsystems
    desc: |
      This message allows setting a mask to prevent a particular satellite
      from being used in various Piksi subsystems.
    fields:
        - mask:
            type: u8
            desc: Mask of systems that should ignore this satellite.
            fields:
                - 2-7:
                    desc: Reserved
                - 1:
                    desc: Tracking channels
                    values:
                        - 0: Enabled
                        - 1: Drop this PRN if currently tracking
                - 0:
                    desc: Acquisition channel
                    values:
                        - 0: Enabled
                        - 1: Skip this satellite on future acquisitions
        - sid:
            type: GnssSignal
            desc: GNSS signal for which the mask is applied

